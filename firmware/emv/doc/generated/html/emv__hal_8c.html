<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AS3911 EMV L1 Certification Firmware: emv_hal.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AS3911 EMV L1 Certification Firmware</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_1ff1735090b84fa9ff4cd225af1d4c47.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_a2d317b43e9e27106ed0be4631497edf.html">EMV</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">emv_hal.c File Reference</div>  </div>
</div>
<div class="contents">

<p>EMV module RFID hardware abstraction layer.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="emv__hal_8h.html">emv_hal.h</a>&quot;</code><br/>
<code>#include &quot;errno.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="emv__standard_8h.html">emv_standard.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="as3911_8h.html">AS3911/as3911.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sleep_8h.html">sleep.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="emv__hal_8c.html#a1e68b2a0326c79df1fb750510b3ff151">EMV_HAL_REG_OPCONTROL_TXEN_BIT</a>&#160;&#160;&#160;0x08</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="emv__hal_8c.html#ae7655d810a065e52b1497100b2234255">EMV_HAL_ISO14443A_RECEIVER_DEADTIME</a>&#160;&#160;&#160;(1108 - 276 - 64)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="emv__hal_8c.html#af9df0292015c380d8c85c44ca3544330">EMV_HAL_ISO14443B_RECEIVER_DEADTIME</a>&#160;&#160;&#160;(1024 - 340 - 64)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="emv__hal_8c.html#af5be0375307d53142060ffd16f9d0df0">EMV_HAL_TYPE_A_TIMEOUT_ADJUSTMENT</a>&#160;&#160;&#160;512</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="emv__hal_8c.html#a9fc71010e31f2e9010ace51b8d39f3f7">EMV_HAL_TYPE_B_TIMEOUT_ADJUSTMENT</a>&#160;&#160;&#160;6360</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga5bd090c73c3cc59b664cade9f7b230fb">emvHalSleepMilliseconds</a> (u16 milliseconds)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for <em>millseconds</em> milliseconds.  <a href="group__emv_hal.html#ga5bd090c73c3cc59b664cade9f7b230fb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#gabd3061e00845603168e83981a7fbeaa4">emvHalSetStandard</a> (<a class="el" href="group__emv_hal.html#gae3a828870ffbaeb8a604357300b61964">EmvHalStandard_t</a> standard)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the RFID standard to be used by the EMV HAL layer.  <a href="group__emv_hal.html#gabd3061e00845603168e83981a7fbeaa4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga28e47686b13d28238c4ae5794de9d61c">emvHalSetErrorHandling</a> (<a class="el" href="group__emv_hal.html#gaf325c890a4b7b44ef26e6fb3d36b2cfa">EmvHalErrorHandling_t</a> errorHandling)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the EMV error handling mode.  <a href="group__emv_hal.html#ga28e47686b13d28238c4ae5794de9d61c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga7e36f95bb30052f93dd254bc18a9e835">emvHalActivateField</a> (bool_t activateField)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Activate or deactivate the reader field.  <a href="group__emv_hal.html#ga7e36f95bb30052f93dd254bc18a9e835"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga2da4c8134b17bcad7dfe6c41510f119f">emvHalFieldIsActivated</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the reader field is activated or not.  <a href="group__emv_hal.html#ga2da4c8134b17bcad7dfe6c41510f119f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga2f67d17faf45fe6fe24c8b37ee258b64">emvHalResetField</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the reader field.  <a href="group__emv_hal.html#ga2f67d17faf45fe6fe24c8b37ee258b64"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#ga44bbb908adba3b0524f1b07820d1e89d">emvHalTransceive</a> (const u8 *request, size_t requestLength, u8 *response, size_t maxResponseLength, size_t *responseLength, u32 timeout, <a class="el" href="group__emv_hal.html#ga41b19fbc2477bf08d616136e56b6b5ef">EmvHalTransceiveMode_t</a> transceiveMode)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a request to the PICC and store the response.  <a href="group__emv_hal.html#ga44bbb908adba3b0524f1b07820d1e89d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__emv_hal.html#gac303b5790ebf24422f0b6f89266c9410">emvHalSetAs3911TypeBModulationMode</a> (<a class="el" href="group__as3911_rfid_com.html#ga9860369f946c6932c18c7ca07da4351a">AS3911ModulationLevelMode_t</a> modulationLevelMode, const void *modulationLevelModeData)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set AS3911 type B modulation mode.  <a href="group__emv_hal.html#gac303b5790ebf24422f0b6f89266c9410"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><dl class="author"><dt><b>Author:</b></dt><dd>Oliver Regenfelder </dd></dl>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="ae7655d810a065e52b1497100b2234255"></a><!-- doxytag: member="emv_hal.c::EMV_HAL_ISO14443A_RECEIVER_DEADTIME" ref="ae7655d810a065e52b1497100b2234255" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EMV_HAL_ISO14443A_RECEIVER_DEADTIME&#160;&#160;&#160;(1108 - 276 - 64)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receiver dead time (in carrier cycles) for the ISO14443A protocol. See [CCP v2.01, PCD 4.8.1.3]. Calculation:</p>
<p>1108: Deaftime if the last transmitted data bis was logic '1'</p>
<p>276: Time from the rising pulse of the pause of the logic '1' (i.e. the timepoint to measure the deaftime from), to the actual end of the EOF sequence (the point where the MRT starts). Please note that the AS3911 uses the ISO14443-2 definition where the EOF consists of logic '0' followed by sequence Y.</p>
<p>64: Adjustment for the MRT timer jitter. Currently the MRT timer will have any timeout between the set timeout and the set timout + 64 cycles. </p>

</div>
</div>
<a class="anchor" id="af9df0292015c380d8c85c44ca3544330"></a><!-- doxytag: member="emv_hal.c::EMV_HAL_ISO14443B_RECEIVER_DEADTIME" ref="af9df0292015c380d8c85c44ca3544330" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EMV_HAL_ISO14443B_RECEIVER_DEADTIME&#160;&#160;&#160;(1024 - 340 - 64)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receiver dead time (in carrier cycles) for the ISO14443B protocol. See [CCP v2.01, PCD 4.8.1.3].</p>
<p>1024: TR0_MIN</p>
<p>340: Time from the rising edge of the EoS to the starting point of the MRT timer (sometime after the final high part of the EoS is completed).</p>
<p>64: Adjustment for the MRT timer jitter. Currently the MRT timer will have any timeout between the set timeout and the set timout + 64 cycles. </p>

</div>
</div>
<a class="anchor" id="a1e68b2a0326c79df1fb750510b3ff151"></a><!-- doxytag: member="emv_hal.c::EMV_HAL_REG_OPCONTROL_TXEN_BIT" ref="a1e68b2a0326c79df1fb750510b3ff151" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EMV_HAL_REG_OPCONTROL_TXEN_BIT&#160;&#160;&#160;0x08</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>AS3911 operation control register transmit enable bit mask. </p>

</div>
</div>
<a class="anchor" id="af5be0375307d53142060ffd16f9d0df0"></a><!-- doxytag: member="emv_hal.c::EMV_HAL_TYPE_A_TIMEOUT_ADJUSTMENT" ref="af5be0375307d53142060ffd16f9d0df0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EMV_HAL_TYPE_A_TIMEOUT_ADJUSTMENT&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Adjustment from the timeout requested by the caller to the timeout value which has to be used for the AS3911. </p>

</div>
</div>
<a class="anchor" id="a9fc71010e31f2e9010ace51b8d39f3f7"></a><!-- doxytag: member="emv_hal.c::EMV_HAL_TYPE_B_TIMEOUT_ADJUSTMENT" ref="a9fc71010e31f2e9010ace51b8d39f3f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EMV_HAL_TYPE_B_TIMEOUT_ADJUSTMENT&#160;&#160;&#160;6360</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Adjustment from the timeout requested by the caller to the timeout value which has to be used for the AS3911. </p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Apr 17 2012 12:33:39 for AS3911 EMV L1 Certification Firmware by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
